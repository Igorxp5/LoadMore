/*
 * Load More - Javascript Plugin
 * Plugin for load more something in elements
 *
 * 
 * Author: Igor Fernandes
 * Version:  2.0-dev
 * License: LCS
 *
 * Copyright 2015
 * 
 */

function loadMore(e,t){"use strict";var n=this;var r={name:"Load More",pluginVersion:"2.1",replacerKeys:"{{@%s%}}"};var i=["config","baseElement"];var s={config:{object:"",method:"GET",requestData:null},itemsInit:1,itemsPerLoad:1,buttonToLoadMore:null,baseElement:null,minDelay:0,effectOnLoadItems:false,onLoadData:function(e){void 0},beforeLoadMore:function(e){void 0},afterLoadMore:function(e,t){void 0},lastLoadMore:function(e){void 0},clickButtonLoadMore:function(){void 0},alwaysEndLoadMore:function(){void 0}};var o=["fadeIn","zoomIn"];var u=e,a=null,f=new Object,l="GET",c="",h=null,p=1,d=null,v=null,m=null;this.minDelay=0;this.itemsPerLoad=1,this.loadMoreTimes=0;this.effectOnLoadItems=false;var g=function(e,t,n){var r=typeof t;t=L.variableNotExitType(t,n);if(t===false){E(2,{find:["%p%","%t%"],replace:[e,r]});return false}return n};var y=function(){n.minDelay=g("minDelay",n.minDelay,s.minDelay);n.itemsPerLoad=g("itemsPerLoad",n.itemsPerLoad,s.itemsPerLoad);p=g("itemsInit",p,s.itemsInit);l=g("Data - Method",l,s.config.method);var e=typeof s.config.object;if(!L.alternateValueComparate(e,["string","object"])){E(2,{find:["%p%","%t%"],replace:["Data - URL","string or object"]})}else if(e=="string"){var t=L.urlObject(s.config.object);a=t["protocol"]+"//"+t["host"]+t["pathname"]}else if(e=="object"){f=s.config.object}var r=typeof s.baseElement;var i;if(!L.alternateValueComparate(r,["string","object"])||r=="object"&&!L.isElement(s.baseElement)){E(2,{find:["%p%","%t%"],replace:["baseElement","string or element"]})}else if(r=="string"){i=document.querySelector(s.baseElement);if(i==null){E(3,{find:["%s%"],replace:[s.baseElement]})}}else if(r=="object"){i=s.baseElement}h=i.cloneNode(true);h.removeAttribute("id");i.remove();if(s.buttonToLoadMore!=null&&s.buttonToLoadMore!=undefined){var v=typeof s.buttonToLoadMore;if(v=="string"){d=document.querySelector(s.buttonToLoadMore);if(d==null){E(3,{find:["%s%"],replace:[s.buttonToLoadMore]})}}else if(v=="object"){if(!L.isElement(s.buttonToLoadMore)){E(2,{find:["%p%","%t%"],replace:["buttonToLoadMore","string or element"]})}d=s.buttonToLoadMore}}else{d=null}var y=typeof s.effectOnLoadItems;if(!L.alternateValueComparate(y,["string","boolean"])){E(2,{find:["%p%","%t%"],replace:["effectOnLoadItems","string or booelan"]})}else if(s.effectOnLoadItems===true){E(4)}else if(y=="string"&&o.indexOf(s.effectOnLoadItems)==-1){E(5)}else if(o.indexOf(s.effectOnLoadItems)!=-1){n.effectOnLoadItems=s.effectOnLoadItems}var b=typeof s.config.requestData;if(c!=null){if(b!="object"){E(2,{find:["%p%","%t%"],replace:["postData","object"]})}else{c=s.config.requestData}}m=u.cloneNode(0);n.onLoadData=g("onLoadData",n.onLoadData,s.onLoadData);n.beforeLoadMore=g("beforeLoadMore",n.beforeLoadMore,s.beforeLoadMore);n.afterLoadMore=g("afterLoadMore",n.afterLoadMore,s.afterLoadMore);n.lastLoadMore=g("lastLoadMore",n.lastLoadMore,s.lastLoadMore);n.clickButtonLoadMore=g("clickButtonLoadMore",n.clickButtonLoadMore,s.clickButtonLoadMore);n.alwaysEndLoadMore=g("alwaysEndLoadMore",n.alwaysEndLoadMore,s.alwaysEndLoadMore)};var b=function(e){if(L.objLength(f)>0){e();return true}else{L.requestAJAX(a,l.toLowerCase(),c,function(t){e(t)})}};var w=["Not exists parameters in function loadMore","The required parameters are "+i.join(", "),"The parameter %p% must be of type %t%","Can not find the element with selector equal: %s%","Select the effect in the parameter effectOnLoadItems, the your value can't be equal true","Not exists this effect, the available effects are: "+o.join(", "),"In function %f% - The %a% must be of type %t%"];var E=function(e,t){var n=t!=undefined?L.replaceArray(w[e],t["find"],t["replace"]):w[e];throw new Error(r.pluginName+" - "+n+".")};var S=function(){if(d!=null){buttonLoadMore.addEventListener("click",function(){n.loadMore({},n.itemsPerLoad)})}};var x=function(e){if(e){var t=0;for(var r in i){if(Object.keys(e).indexOf(i[r])!=-1){if(i[r]=="config"){if(e.config.object!=undefined){t++}continue}t++}else{break}}if(t!=i.length){E(1)}for(var o in e){if(s.hasOwnProperty(o)){if(typeof e[o]=="object"&&!L.isElement(e[o])){for(var r in e[o]){s[o][r]=e[o][r]}}else{s[o]=e[o]}}}}else{E(0)}y();b(function(e){if(e){if(typeof e!="oject"){f=JSON.parse(e)}}n.onLoadData(f);S();n.loadMore({},p)})};var T=function(e,t){var r=v==null?f:v;e=e==undefined?new Object:e;t=t==undefined?n.itemsPerLoad:t;if(r.length==0){n.alwaysEndLoadMore();return false}if(typeof e!="object"){E(6,{find:["%f%","%a%","%t%"],replace:["loadMore","first argument (specificLoad)","object"]})}if(typeof t!="number"){E(6,{find:["%f%","%a%","%t%"],replace:["loadMore","second argument (itemsToLoad)","number"]})}return{objectInitial:r,specificLoad:e,itemsToLoad:t}};var N=function(e){u.innerHTML+=e};var C=function(e){if(n.effectOnLoadItems==false){return e}u.style.transition="height .5s";for(var t=0;t<e.childNodes.length;t++){if(e.childNodes[t]==undefined||e.childNodes[t].style==undefined){continue}e.childNodes[t].style.opacity="0";e.childNodes[t].style.height="0";e.childNodes[t].style.width="0";e.childNodes[t].style.margin="0";e.childNodes[t].style.padding="0";e.childNodes[t].style.transition="height .5s, width .5s, opacity .7s, margin .5s, padding .5s";if(n.effectOnLoadItems=="zoomIn"){e.childNodes[t].style.transition="height .5s, width .5s, opacity .7s, margin .5s, padding .5s, transform .5s";e.childNodes[t].style.transform="scale3d(.3, .3, .3)"}}return e};var k=function(){if(n.effectOnLoadItems==false){return false}setTimeout(function(){for(var e=0;e<u.childNodes.length;e++){if(u.childNodes[e]==undefined||u.childNodes[e].style==undefined){continue}u.childNodes[e].style.height="";u.childNodes[e].style.width="";u.childNodes[e].style.margin="";u.childNodes[e].style.padding=""}if(n.effectOnLoadItems=="fadeIn"){setTimeout(function(){for(var e=0;e<u.childNodes.length;e++){if(u.childNodes[e]==undefined||u.childNodes[e].style==undefined){continue}u.childNodes[e].style.opacity=""}u.style.transition=""},500)}else if(n.effectOnLoadItems=="zoomIn"){setTimeout(function(){for(var e=0;e<u.childNodes.length;e++){if(u.childNodes[e]==undefined||u.childNodes[e].style==undefined){continue}u.childNodes[e].style.opacity="";u.childNodes[e].style.transform=""}u.style.transition=""},500)}},500)};this.loadMore=function(e,t){n.beforeLoadMore(n.loadMoreTimes);var i=T(e,t);var s=i.objectInitial;var e=i.specificLoad;var t=i.itemsToLoad;if(!i){return false}var o=new Object;if(L.objLength(e)>0){var a=L.search(objInitial,e);o=a!=-1?a:s}o=s;var f=[];var l=document.createElement("div");for(var c=0;c<t;c++){var p=o[c];f.push(p);var d=h.cloneNode(true);var m=L.getCompleteHTML(d);var g=r.replacerKeys.split("%s%");for(var y in p){var b=g[0]+y+g[1];m=m.replace(new RegExp(b,"g"),p[y])}d=L.createElementFromHTML(m);l.appendChild(d)}l=C(l);v=L.severalSplice(s,f);setTimeout(function(){N(l.innerHTML);k();if(L.objLength(v)==0){n.lastLoadMore()}},n.minDelay);var w=[];for(var c=u.childNodes.length-1;c>=u.childNodes.length-t;c--){var E=u.childNodes[c];w.push(E)}n.loadMoreTimes++;n.afterLoadMore(w,n.loadMoreTimes)};this.destroy=function(){u.innerHTML=m.innerHTML};this.onLoadData=function(e){void 0};this.beforeLoadMore=function(e){void 0};this.afterLoadMore=function(e,t){void 0};this.lastLoadMore=function(){void 0};this.clickButtonLoadMore=function(){void 0};this.alwaysEndLoadMore=function(){void 0};var L={isElement:function(e){return!!(e&&e.nodeType==1)},requestAJAX:function(e,t,n,r){var i={};i.x=function(){if(typeof XMLHttpRequest!=="undefined"){return new XMLHttpRequest}var e=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];var t;for(var n=0;n<e.length;n++){try{t=new ActiveXObject(e[n]);break}catch(r){}}return t};i.send=function(e,t,n,r){var s=i.x();s.open(n,e);s.onreadystatechange=function(){if(s.readyState==4){t(s.responseText)}};if(n=="POST"){s.setRequestHeader("Content-type","application/x-www-form-urlencoded")}s.send(r)};i.get=function(e,t,n){var r=[];for(var s in t){r.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]))}i.send(e+"?"+r.join("&"),n,"GET",null)};i.post=function(e,t,n){var r=[];for(var s in t){r.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]))}i.send(e,n,"POST",r.join("&"))};i[t](e,n,r)},alternateValueComparate:function(e,t){for(var n in t){if(e==t[n]){return true}}return false},variableNotExitType:function(e,t){if(typeof e==typeof t)return t;return false},replaceArray:function(e,t,n){for(var r=0;r<t.length;r++){e=e.replace(new RegExp(t[r],"g"),n[r])}return e},objLength:function(e){if(typeof e!="object"||e==null)return false;return Object.keys(e).length},urlObject:function(e){var t=document.createElement("a");t.setAttribute("href",e);var n={protocol:t.protocol,hostname:t.hostname,host:t.host,port:t.port,hash:t.hash.substr(1),pathname:t.pathname,search:t.search};return n},search:function(e,t){if(!(Object.keys(t).length>0))return e;var n=[];for(var r in e){var i=e[r];var s=0;for(var o in t){if(i[o]!=t[o])break;s++;if(s==Object.keys(t).length)n.push(i)}}if(n.length==0)return-1;else return n},severalSplice:function(e,t){if(L.objLength(e)==0){return n}var n=e;for(var r in t){var i=n.indexOf(t[r]);if(i!=-1)n.splice(i,1)}return n},getCompleteHTML:function(e){var t=e.cloneNode(true);var n=document.createElement("div");n.appendChild(t);return n.innerHTML},createElementFromHTML:function(e){var t=document.createElement("div");t.innerHTML=e;return t.childNodes[0]}};x(t)}Element.prototype.loadMore=function(e){return new loadMore(this,e)}